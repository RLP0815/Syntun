<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="security" uri="http://www.springframework.org/security/tags"%>  
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta charset="utf-8">
	<title>获取网页代码</title>
	<%@include file="/page/include/getUserInfo.jsp"%>
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="format-detection" content="telephone=no">
	<link rel="stylesheet" href="../../../layui/css/layui.css" media="all" />
	<link rel="stylesheet" href="../../../css/public.css" media="all" />
	<link rel="stylesheet" href="../../../js/jquery/jquery-ui.css" media="all" />
</head>
<script type="text/javascript">
	var nickName = '<%=nickName%>';
	var userId = '<%=userId%>';
	var userName = '<%=userName%>';
	var email = '<%=email%>';
	var phoneno = '<%=phoneno%>';
<%-- 	var authorities = '<%=authorities%>'; --%>
</script>

<body>
	<input id="ctx" style="display:none" value="${pageContext.request.contextPath}">
	<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
		<legend>获取网页所需参数</legend>
	</fieldset>
	<form class="layui-form" style="width:99%;">
		<div class="layui-form-item">
		    <label class="layui-form-label">URL</label>
		    <div class="layui-input-block">
				<input type="text" class="layui-input url" lay-verify="required" autocomplete="off" placeholder="请输入URL">
		    </div>
		</div>
		<div class="layui-form-item">
		    <label class="layui-form-label">父URL</label>
		    <div class="layui-input-block">
				<input type="text" class="layui-input urlParent" lay-verify="" autocomplete="off" placeholder="请输入父URL">
		    </div>
		</div>
		<div class="layui-form-item">
		    <label class="layui-form-label">cookie</label>
		    <div class="layui-input-block">
				<input type="text" class="layui-input cookie" lay-verify="" autocomplete="off" placeholder="请输入Cookie">
		    </div>
		</div>
		<div class="layui-form-item">
		    <label class="layui-form-label">userAgent</label>
		    <div class="layui-input-block">
				<input type="text" class="layui-input userAgent" lay-verify="" autocomplete="off" placeholder="请输入UserAgent">
		    </div>
		</div>
		<div class="layui-form-item">
			<div class="layui-col-md6">
			    <label class="layui-form-label">pattern1</label>
			    <div class="layui-input-block">
					<input type="text" class="layui-input patternStr1" lay-verify="required" autocomplete="off" placeholder="请输入patternStr1">
			    </div>
			</div>
			<div class="layui-col-md6">
			    <label class="layui-form-label">group1</label>
			    <div class="layui-input-block">
					<input type="text" class="layui-input group1" lay-verify="required" autocomplete="off" placeholder="请输入group1(多个用逗号“,”隔开)">
			    </div>
			</div>
		</div>
		<div class="layui-form-item">
			<div class="magb15 layui-col-md6 layui-col-xs12">
			    <label class="layui-form-label">pattern2</label>
			    <div class="layui-input-block">
					<input type="text" class="layui-input patternStr2" lay-verify="required" autocomplete="off" placeholder="请输入patternStr2">
			    </div>
			</div>
			<div class="magb15 layui-col-md6 layui-col-xs12">
			    <label class="layui-form-label">group2</label>
			    <div class="layui-input-block">
					<input type="text" class="layui-input group2" lay-verify="required" autocomplete="off" placeholder="请输入group2(多个用逗号“,”隔开)">
			    </div>
			</div>
		</div>
		<div class="layui-form-item">
			<div class="layui-input-block">
				<button class="layui-btn urlSubmit" lay-submit="" lay-filter="urlSubmit">提交</button>
				<button type="reset" class="layui-btn layui-btn-primary">重置</button>
			</div>
		</div>
	</form>
<div id="remarkRecord" style="display:none;">
		<div class="layui-row">
			<div class="magb15 layui-col-md6 layui-col-xs12">
				<label class="layui-form-label">pattern1</label>
				<div class="layui-input-block">
					<input type="text" class="layui-input pattern1" lay-verify="required" placeholder="请选择平台">
				</div>
			</div>
			<div class="magb15 layui-col-md6 layui-col-xs12">
				<label class="layui-form-label">pattern2</label>
				<div class="layui-input-block">
					<input type="text" class="layui-input pattern2" lay-verify="required" placeholder="请选择平台">
				</div>
			</div>
		</div>
		<div class="layui-form-item layui-form-text">
		    <label class="layui-form-label">采集结果</label>
		    <div class="layui-input-block">
		      <textarea placeholder="请输入内容" style="height:360px;" class="layui-textarea out"></textarea>
		    </div>
		</div>
</div>
<script type="text/javascript" src="../../../js/jquery/jquery-3.3.1.js"></script>
<script type="text/javascript" src="../../../js/jquery/jquery-ui.js"></script>
<script type="text/javascript" src="../../../layui/layui.js"></script>
<script type="text/javascript">
layui.use(['form','layer','laytpl'],function(){

	var form = layui.form,
        layer = parent.layer === undefined ? layui.layer : top.layer,
        $ = layui.jquery,
        laytpl = layui.laytpl;
        
	//立即提交
	form.on("submit(urlSubmit)",function(data){
		//弹出loading
		var index = top.layer.msg('数据提交中，请稍候',{icon: 16,time:false,shade:0.8});
		$.post($("#ctx").attr("value") + '/baseController/getUrl.ht',{
		   url : $(".url").val(),
		   urlParent : $(".urlParent").val(),
		   cookie : $(".cookie").val(),
		   userAgent : $(".userAgent").val(),
		   patternStr1 : $(".patternStr1").val(),
		   group1 : $(".group1").val(),
		   patternStr2 : $(".patternStr2").val(),
		   group2 : $(".group2").val(),
	    },function(res){
	    	if(JSON.parse(res).code == 0){ 
				top.layer.msg(JSON.parse(res).msg); 
		    	var title = "返回参数";
	            $(".pattern1").val(JSON.parse(res).pattern1);  
	        	$(".pattern2").val(JSON.parse(res).pattern2); 
	        	$(".out").val(JSON.parse(res).out); 
		    	
		    	$("#remarkRecord").dialog({  
		            //autoOpen : false,   // 是否自动弹出窗口  
		            modal : true,    // 设置为模态对话框  
		            resizable : true,  
		            width : 1150,   //弹出框宽度  
		            height : 550,   //弹出框高度  
		            title : title,  //弹出框标题  
		            position: { my: "center top", at: "center top", of: window },
		            closeText : '关闭',
		            buttons:{  
			            '关闭':function(){  
			            	$(".pattern1").val("");  
			 	        	$(".pattern2").val("");   
			 	        	$(".out").val(""); 
			            	$(this).dialog("close");  
			            }  
		            } 
		       });
	        }else{
	        	layer.alert(JSON.parse(res).msg, {
	        		icon: 5,
	        		title: "警告"
	        	});
	        } 
	    })
	    return false;
	});    
})

	
</script>
</body>
</html>